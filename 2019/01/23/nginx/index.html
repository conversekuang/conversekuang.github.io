<!-- build time:Thu May 23 2019 00:50:30 GMT+0800 (GMT+08:00) --><!DOCTYPE html><html class="theme-next pisces use-motion" lang="zh-Hans"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="nginx,代理服务器"><meta name="description" content="最近在准备项目需要的一些知识，后续项目可能会用到nginx用作负载均衡。今天主要学习了一下nginx的及一些基本知识与应用，后续还会针对负载均衡进行学习。"><meta name="keywords" content="nginx,代理服务器"><meta property="og:type" content="article"><meta property="og:title" content="nginx  for  windows"><meta property="og:url" content="http://yoursite.com/2019/01/23/nginx/index.html"><meta property="og:site_name" content="A Little Faith"><meta property="og:description" content="最近在准备项目需要的一些知识，后续项目可能会用到nginx用作负载均衡。今天主要学习了一下nginx的及一些基本知识与应用，后续还会针对负载均衡进行学习。"><meta property="og:locale" content="zh-Hans"><meta property="og:updated_time" content="2019-01-24T12:31:54.202Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="nginx  for  windows"><meta name="twitter:description" content="最近在准备项目需要的一些知识，后续项目可能会用到nginx用作负载均衡。今天主要学习了一下nginx的及一些基本知识与应用，后续还会针对负载均衡进行学习。"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Pisces",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://yoursite.com/2019/01/23/nginx/"><title>nginx for windows | A Little Faith</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">A Little Faith</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">慢慢来会比较快</p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首&emsp;&emsp;页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>本人档案</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标&emsp;&emsp;签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分&emsp;&emsp;类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归&emsp;&emsp;档</a></li></ul></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/23/nginx/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="conversekuang"><meta itemprop="description" content=""><meta itemprop="image" content="/uploads/avatar.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="A Little Faith"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">nginx for windows</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-23T23:18:23+08:00">2019-01-23 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/nginx/" itemprop="url" rel="index"><span itemprop="name">nginx</span> </a></span></span><span id="/2019/01/23/nginx/" class="leancloud_visitors" data-flag-title="nginx  for  windows"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">热度&#58;</span> <span class="leancloud-visitors-count"></span> <span>℃</span></span><div class="post-wordcount"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">2.1k 字 </span><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">8 分钟</span></div></div></header><div class="post-body" itemprop="articleBody"><p>最近在准备项目需要的一些知识，后续项目可能会用到nginx用作负载均衡。今天主要学习了一下nginx的及一些基本知识与应用，后续还会针对负载均衡进行学习。</p><a id="more"></a><h1>nginx for windows</h1><h3 id="nginx-相关知识"><a class="header-anchor" href="#nginx-相关知识">¶</a>nginx 相关知识</h3><blockquote><p>nginx是什么？</p></blockquote><p>nginx （发音[engine x]） 是HTTP与反向代理服务器，邮件代理服务器，TCP/UDP代理服务器。</p><p><a href="https://www.cnblogs.com/leonxyzh/p/7497869.html" target="_blank" rel="noopener">Dropbox</a> ：用于代理层，处理延时敏感的数据交互以及高吞吐量的数据传输。</p><p><a href="https://openconnect.netflix.com/en/software/" target="_blank" rel="noopener">Netflix</a> ：nginx被选做web 服务器，用于提高扩展性和提升性能。</p><p><a href="https://www.nginx.com/case-studies/nginx-wordpress-com/" target="_blank" rel="noopener">Wordpress.com</a> ：主要采用nginx用于负载均衡。</p><p><a href="http://blog.fastmail.fm/2007/01/04/webimappop-frontend-proxies-changed-to-nginx/" target="_blank" rel="noopener">FastMail.FM</a> ：采用了nginx作为邮件代理服务器。</p><blockquote><p>nginx组成</p></blockquote><p>nginx由1个master node 和多个worker node组成。</p><p>master node: 读取、检验配置信息，维护worker node进程。</p><p>worker node: 处理实际的请求。</p><p>nginx采用<strong>事件驱动模型</strong> 与<strong>独立于操作系统的机制</strong>将请求高效的分配到worker node上进行处理。worker node的数目可以在conf配置文件中进行设置，一般worker node节点的数量不超过CPU核心数量。</p><h3 id="nginx-windows介绍"><a class="header-anchor" href="#nginx-windows介绍">¶</a>nginx windows介绍</h3><p>nginx的windows版本在功能上与Unix版本没有太大差异，除了以下功能：XSLT过滤, 图片过滤, GeoIP模块, 与 内嵌 Perl语言。但是，windows版本的nginx在性能上与unix版本相差甚远。因此，windows版本被视为是测试版本。造成性能差异的原因(known issues)有以下几个：</p><ul><li><p>nginx 的Windows版本使用的是本地的Win32 API，只有<code>select()</code>连接方法目前可以使用</p></li><li><p>尽管可以开启多个worker nodes，但实际只有一个进行工作</p></li><li><p>worker node 能够同时处理的连接数不能超过1024</p></li><li><p>不支持UDP代理功能</p></li></ul><hr><blockquote><p>安装运行nginx</p></blockquote><p>在官网进行下载压缩包 <a href="http://nginx.org/en/docs/windows.html" target="_blank" rel="noopener">http://nginx.org/en/docs/windows.html</a></p><p>解压后，通过命令行在压缩包路径下使用命令</p><ul><li><p><strong>启动nginx</strong>：<code>start nginx</code></p></li><li><p>查看nginx 进程：<code>tasklist /fi &quot;imagename eq nginx.exe&quot;</code></p><p>会得到如下结果：</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">映像名称      PID    会话名  会话#   内存使用</span><br><span class="line">==========  ====  ======== ==== =========</span><br><span class="line">nginx.exe   1332  Console   1    5,608 K</span><br><span class="line">nginx.exe   6024  Console   1    6,044 K</span><br></pre></td></tr></table></figure><p>可以看到结果显示有两个进程，这是因为nginx默认的配置是1个worker node，再加上mater node，因此共有2个进程。</p><p>再访问http://localhost:80 可以显示 nginx 访问成功的页面。</p><p>那么简单的nginx配置以及运用成功。</p><blockquote><p>nginx 命令</p></blockquote><table><thead><tr><th>命令</th><th>内容</th></tr></thead><tbody><tr><td>nginx -s stop</td><td>快速关闭（强制关闭，可能存在未处理完的任务）</td></tr><tr><td>nginx -s quit</td><td>优雅的关闭（当任务都处理完再进行关闭）</td></tr><tr><td>nginx -s reload</td><td>改变配置的时候，以新的配置创建worker node，当老的worker node完成任务后关闭</td></tr><tr><td>nginx -s reopen</td><td>重新打开log</td></tr></tbody></table><blockquote><p>reload 命令</p></blockquote><p>打开nginx目录下的conf/nginx.conf文件，可以对nginx进行配置。当修改配置文件后，新的配置信息不会立即被使用。nginx需要通过reload 命令<code>nginx -s reload</code>加载更新的配置文件或者重启nginx，新的配置信息才会生效。</p><p>当执行<code>nginx -s reload</code>命令后，master node会接收到reload重加载的信号，首先检查新配置信息语法的合法性。</p><ul><li>在配置信息的存在问题，master node将撤回更改并继续按照原来的配置信息工作。</li><li>在配置信息的无误情况下，master node会产生新的 worker node并发送信息到old worker node，让他们关闭。old worker node在接收到关闭的命令后，将停止接收新请求，并将当前进程中还没处理完的请求处理完后，old worker node进程才会退出。</li></ul><h3 id="配置nginx-conf文件"><a class="header-anchor" href="#配置nginx-conf文件">¶</a>配置nginx.conf文件</h3><blockquote><p>配置文件结构</p></blockquote><p>nginx包括很多的模块，由配置文件的指令进行控制。</p><p>指令包括：简单指令和块指令。注释采用#进行注释</p><ul><li><p>简单指令包括：命令名称与参数，用空格分割开，结尾以&quot;;&quot;结束。</p></li><li><p>块指令：与简单指令的结构一样，只是由花括号{ }包裹起来。</p><p>块指令中在花括号中包含其他的指令。这些叫做“context”（例如，http,server等）。</p></li></ul><p>部分指令在虽然配置文件中但是不在任何contexts中，那么这些指令被视为在 main context中。</p><p>如下是nginx.conf文件的一部分：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#user  nobody;</span><br><span class="line">worker_processes  2;               #简单指令</span><br><span class="line"></span><br><span class="line">events &#123;                           #块指令</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http&#123;</span><br><span class="line">    server&#123;</span><br><span class="line">        location&#123;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>worker_processes，events，http均位于 main context；</p><p>server在http context中，location在server context中。</p><blockquote><p>提供静态资源</p></blockquote><p>web服务器一个最重要的工作就是提供服务文件（例如，静态HTML网页或者图片）。下面就进行一个demo，根据不同的请求nginx将从不同的路径下获取资源。</p><ul><li><p>在nginx.conf文件中已经写好一些server的设置，在试验的时候建议都把他们注释掉。</p></li><li><p>在http{ } 块内创建一个新的server块，如下所示：</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    location / &#123;</span><br><span class="line">        root data/www;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location /images/ &#123;</span><br><span class="line">        root data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>尤其注意：<font color="red">root 后面的格式写法</font>。默认是相对路径的写法，也可以使用绝对路径。</strong></p><p>以上我们已经配置好路径信息，再将资源放到路径下。</p><p>D:\nginx-1.15.8\data\www\some 路径中创建一个 example.html</p><p>D:\nginx-1.15.8\data\images 路径中创建一个 example.png</p><p>最后，我们需要使用start或者reload命令来更新配置信息。</p><ul><li>URL请求与nginx查找资源返回</li></ul><p>一般来说，配置文件会包括一些已经配置好的server块，它们可以通过<strong>服务器名称</strong>和<strong>端口</strong>进行区分（在上面的配置中，我们并没有指明端口，因为默认是使用80端口的）。当一个URI请求到达时，nginx会根据URI来判断到底由哪个server来处理请求，并根据URI中的参数与server块中的location 指定前缀 进行比对。当URI中的参数与多个location路径相匹配，nginx将选择location前缀<strong>匹配最长</strong>的那个location路径来执行，其他的location路径则会匹配失败。</p><p>首先，我们采用如下URI请求资源：</p><p>（1）<code>http://localhost/images/example.png</code></p><p>URI中<code>/images/example.png</code>能够匹配location 前缀/ 与前缀 /images/，但是前缀/images/与URI的匹配长度最长，因此nginx将在 **data/**文件夹下寻找资源。最后根据URI的请求路径，nginx将本地的路径是<code>data/images/example.png</code>的资源返回。</p><p>（2）<code>http://localhost/some/example.html</code></p><p>该URI只与“前缀/”的location进行匹配，因此，根据配置信息，nginx将在 <strong>data/www</strong>文件夹下查找资源。再根据请求路径<code>some/example.html</code>，最终的本地资源路径为<code>data/www/some/example.html</code>。</p><blockquote><p>注意：</p></blockquote><p>URI的请求资源的在本地文件系统路径最终为：匹配location前缀获得的地址 + URI请求路径(URL中的path信息)。例如：data + /images/example.png = data/images/example.png</p><p>所以我们的<strong>资源一定要放对位置</strong>，否则nginx无法获取资源，就回返回404错误信息。</p><blockquote><p>简单的代理服务</p></blockquote><p>最常用的用途之一就是作为代理服务器。</p><p>下面给出一个场景，当对图片的请求时，在代理服务器A处理，其他请求由代理服务器A分发到服务器B进行处理。</p><p>我们在同一个nginx实例上模拟该场景。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">server &#123;                      #模拟服务器A</span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://localhost:8080;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	location ~ \.(gif|jpg|png)$ &#123;</span><br><span class="line">   		 root /data/images;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;                      #模拟服务器B</span><br><span class="line">    listen 8080;</span><br><span class="line">    root /data/up1;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当请求来首先进行前缀匹配，第二个location是对所有后缀为gif,jpg,png的文件进行匹配，这三种图片格式均按第二种映射到本地对应目录，因为匹配长度最长。因此服务器会筛选出图片，而其他的请求，均按第一种映射。在第一种location，通过proxy_pass指令，将实际处理请求的服务器信息给出：协议，域名，端口。这样就服务器A就变成了代理服务器。而 另一个server中，给出监听端口与映射路径，模拟实际处理请求的服务器。</p><p><strong>总结：</strong></p><ul><li>nginx的介绍与组成</li><li>nginx基本命令</li><li>nginx的基本用途</li><li>nginx配置方法</li></ul><hr><p>官网新手指南 <a href="http://nginx.org/en/docs/beginners_guide.html" target="_blank" rel="noopener">http://nginx.org/en/docs/beginners_guide.html</a></p></div><footer class="post-footer"><div class="post-tags"><a href="/tags/nginx/" rel="tag"><i class="fa fa-tag"></i> nginx</a> <a href="/tags/proxy-server/" rel="tag"><i class="fa fa-tag"></i> proxy server</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2019/01/06/Python coding头的作用/" rel="next" title="Python coding头的作用"><i class="fa fa-chevron-left"></i> Python coding头的作用</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2019/01/24/nginx-load-balance/" rel="prev" title="nginx负载均衡">nginx负载均衡 <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"></div></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/uploads/avatar.jpg" alt="conversekuang"><p class="site-author-name" itemprop="name">conversekuang</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">9</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">8</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">13</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/conversekuang" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:conversekuang@163.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a></span></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#undefined"><span class="nav-number">1.</span> <span class="nav-text">nginx for windows</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#nginx-相关知识"><span class="nav-number">1.0.1.</span> <span class="nav-text">¶nginx 相关知识</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#nginx-windows介绍"><span class="nav-number">1.0.2.</span> <span class="nav-text">¶nginx windows介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置nginx-conf文件"><span class="nav-number">1.0.3.</span> <span class="nav-text">¶配置nginx.conf文件</span></a></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2019</span> <span class="with-love"><i class="fa fa-snowflake-o"></i> </span><span class="author" itemprop="copyrightHolder">conversekuang</span></div><span id="busuanzi_container_site_uv">访客数:<span id="busuanzi_value_site_uv"></span>人次 </span><span class="post-meta-divider">|</span> <span id="busuanzi_container_site_pv">总访问量:<span id="busuanzi_value_site_pv"></span>次 </span><span class="post-meta-divider">|</span><div class="theme-info"><div class="powered-by"></div><span class="post-count">博客全站共18.2k字</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script><script>AV.initialize("2BUTsTA9CLHBUM12kkjxiPQV-gzGzoHsz","lxEOY7cmUDxO3yxePWJlo4TH")</script><script>function showTime(e){var t=new AV.Query(e),n=[],o=$(".leancloud_visitors");o.each(function(){n.push($(this).attr("id").trim())}),t.containedIn("url",n),t.find().done(function(e){var t=".leancloud-visitors-count";if(0===e.length)return void o.find(t).text(0);for(var i=0;i<e.length;i++){var r=e[i],s=r.get("url"),l=r.get("time"),c=document.getElementById(s);$(c).find(t).text(l)}for(var i=0;i<n.length;i++){var s=n[i],c=document.getElementById(s),u=$(c).find(t);""==u.text()&&u.text(0)}}).fail(function(e,t){console.log("Error: "+t.code+" "+t.message)})}function addCount(e){var t=$(".leancloud_visitors"),n=t.attr("id").trim(),o=t.attr("data-flag-title").trim(),i=new AV.Query(e);i.equalTo("url",n),i.find({success:function(t){if(t.length>0){var i=t[0];i.fetchWhenSave(!0),i.increment("time"),i.save(null,{success:function(e){var t=$(document.getElementById(n));t.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to save Visitor num, with error message: "+t.message)}})}else{var r=new e,s=new AV.ACL;s.setPublicReadAccess(!0),s.setPublicWriteAccess(!0),r.setACL(s),r.set("title",o),r.set("url",n),r.set("time",1),r.save(null,{success:function(e){var t=$(document.getElementById(n));t.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to create")}})}},error:function(e){console.log("Error:"+e.code+" "+e.message)}})}$(function(){var e=AV.Object.extend("Counter");1==$(".leancloud_visitors").length?addCount(e):$(".post-title-link").length>1&&showTime(e)})</script></body></html><!-- rebuild by neat -->